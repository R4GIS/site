<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Imagens on Curso-R</title>
    <link>http://curso-r.com/tags/imagens/index.xml</link>
    <description>Recent content in Imagens on Curso-R</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>pt-br</language>
    <copyright>Copyright (c) 2016 - 2017, Curso-R; all rights reserved.</copyright>
    <atom:link href="http://curso-r.com/tags/imagens/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Gráficos miojo: Mapas temáticos do Brasil em 3 minutos ou menos</title>
      <link>http://curso-r.com/blog/2017/05/04/2017-05-04-mapas-tematicos-3-minutos/</link>
      <pubDate>Thu, 04 May 2017 23:26:00 +0300</pubDate>
      
      <guid>http://curso-r.com/blog/2017/05/04/2017-05-04-mapas-tematicos-3-minutos/</guid>
      <description>&lt;p&gt;De todas as visualizações, mapas são aquelas que impressionam mais. É muito mais fácil alguém se maravilhar com o mapa mais simples do que com o &lt;code&gt;ggplot2&lt;/code&gt; mais complicado. Felizmente, considerando essa comparação, o R disponibiliza muitos recursos para construir mapas.&lt;/p&gt;
&lt;p&gt;Dentro do &lt;code&gt;tidyverse&lt;/code&gt; é possível construir mapas usando a função &lt;code&gt;geom_map&lt;/code&gt;, do pacote &lt;code&gt;ggplot2&lt;/code&gt;, mas está fora do escopo deste post explicar como ela funciona. Aqui vamos apenas descobrir como usá-la para agilizar a construção de um gráfico simples.&lt;/p&gt;
&lt;p&gt;Na Associação Brasileira de Jurimetria, nós temos um tipo favorito de mapa. Tipicamente temos interesse em diferenciar as unidades da federação por alguma variável quantitativa, seja ela categorizada ou não, e a ferramenta certa para isso é um mapa temático dos estados. Essa necessidade é tão frequente que as ferramentas mais importantes para construção desses gráficos estão num pacote chamado &lt;code&gt;abjData&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;As coisas estão dispostas de tal forma que, a partir de uma tabela que relaciona uma variavel e os estados brasileiros, construir um gráfico similar ao mapa abaixo pode ser feito chamando apenas uma função[^FBSP].&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dataset %&amp;gt;% 
  constroi_mapa_tematico()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;http://curso-r.com/blog/2017-05-04-mapas-tematicos-3-minutos_files/figure-html/unnamed-chunk-4-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Neste post, vamos construir a função &lt;code&gt;constroi_mapa_tematico&lt;/code&gt; e aprender a implementar alguns &lt;code&gt;tweaks&lt;/code&gt;.&lt;/p&gt;
&lt;div id=&#34;a-funcao&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;A função&lt;/h2&gt;
&lt;p&gt;O &lt;code&gt;geom_map&lt;/code&gt; é uma função do &lt;code&gt;ggplot2&lt;/code&gt; que renderiza coordenadas de mapas. Ela pega um data_frame especial que diz quais coordenadas usar (e como usá-las) e plota no gráfico. Esse mapa normalmente é obtido aplicando a função &lt;code&gt;fortify&lt;/code&gt; em um conjunto de dados geospaciais.&lt;/p&gt;
&lt;p&gt;Para os gráficos que vamos construir aqui, não vai ser necessário aplicar a função &lt;code&gt;fortify&lt;/code&gt;, pois o resultado desse passo já está disponível no pacote &lt;code&gt;abjData&lt;/code&gt; e ele é o data_frame &lt;code&gt;br_uf_map&lt;/code&gt;. Tudo que vamos precisar fazer é pedir que o &lt;code&gt;geom_map&lt;/code&gt; use esse cara.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;devtools::install_github(&amp;#39;abjur/abjData&amp;#39;)
#instala o pacote&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;constroi_mapa_tematico &amp;lt;- function(dataset){
  dataset %&amp;gt;% 
  inner_join(abjData::br_uf_map) %&amp;gt;% {
    ggplot(.) +
    geom_map(aes(x = long, y = lat,
                 map_id = id, fill = variavel),
             color = &amp;#39;gray30&amp;#39;, map = ., data = .) + 
    theme_void() +
    coord_equal()
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;O &lt;code&gt;input&lt;/code&gt; da função é uma tabela &lt;code&gt;dataset&lt;/code&gt; com duas colunas&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;id&lt;/code&gt;, que representa as unidades da federação abreviada;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;variavel&lt;/code&gt;, variável numérica (ou fator) que vai colorir o gráfico.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;No exemplo acima essa tabela era:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dataset %&amp;gt;% 
  head(10)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;FALSE # A tibble: 10 × 2
FALSE       id  variavel
FALSE    &amp;lt;chr&amp;gt;     &amp;lt;dbl&amp;gt;
FALSE 1     TO  94.93079
FALSE 2     SP 278.79676
FALSE 3     SE  35.50231
FALSE 4     SC 204.85650
FALSE 5     RS 169.19369
FALSE 6     RR 114.90413
FALSE 7     RO 152.47085
FALSE 8     RN  26.22847
FALSE 9     RJ 107.42855
FALSE 10    PR 148.47011&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;os-tweaks&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Os tweaks&lt;/h2&gt;
&lt;p&gt;A função &lt;code&gt;constroi_mapa_tematico&lt;/code&gt; devolve um &lt;code&gt;ggplot2&lt;/code&gt;, então ainda dá pra mexer em alguns parâmetros estéticos após a construção do mapa. As três coisas que vamos aprender a fazer são&lt;/p&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;Adicionar labels e títulos&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dataset %&amp;gt;% 
  constroi_mapa_tematico() +
  ggtitle(&amp;quot;Roubos de carros no Brasil em 2014&amp;quot;) +
  scale_fill_continuous(name = &amp;quot;Taxa/100 mil hab.&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;http://curso-r.com/blog/2017-05-04-mapas-tematicos-3-minutos_files/figure-html/unnamed-chunk-8-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;ol start=&#34;2&#34; style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;Alterar as cores da escala&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dataset %&amp;gt;% 
  constroi_mapa_tematico() +
  ggtitle(&amp;quot;Roubos de carros no Brasil em 2014&amp;quot;) +
  scale_fill_continuous(name = &amp;quot;Taxa/100 mil hab.&amp;quot;, low = &amp;#39;white&amp;#39;, high = &amp;#39;red&amp;#39;,
                        na.value = &amp;#39;white&amp;#39;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;http://curso-r.com/blog/2017-05-04-mapas-tematicos-3-minutos_files/figure-html/unnamed-chunk-9-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;ol start=&#34;3&#34; style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;Alterar valores&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dataset %&amp;gt;% 
  constroi_mapa_tematico() +
  ggtitle(&amp;quot;Roubos de carros no Brasil em 2014&amp;quot;) +
  scale_fill_continuous(name = &amp;quot;Taxa/100 mil hab.&amp;quot;, low = &amp;#39;green&amp;#39;, high = &amp;#39;red&amp;#39;,
                        na.value = &amp;#39;white&amp;#39;, breaks = seq(0,300,50))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;http://curso-r.com/blog/2017-05-04-mapas-tematicos-3-minutos_files/figure-html/unnamed-chunk-10-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>As cores da Marvel vs DC</title>
      <link>http://curso-r.com/blog/2017/05/01/2017-05-01-as-paletas-de-cores-da-marvel-vs-dc/</link>
      <pubDate>Mon, 01 May 2017 23:26:00 +0300</pubDate>
      
      <guid>http://curso-r.com/blog/2017/05/01/2017-05-01-as-paletas-de-cores-da-marvel-vs-dc/</guid>
      <description>&lt;p&gt;A cor é uma diferença notável entre os filmes da Marvel e da DC. Enquanto a Disney/Marvel Studios costuma lançar filmes com tons mais claros e alegres, a Warner tem optado por cenários escuros, com um aspecto mais sombrios. Essas escolhas são um reflexo do clima das histórias de cada universo: aventuras engraçaralhas com um drama superficial vs seja lá o que passa na cabeça do &lt;a href=&#34;http://retalhoclub.com.br/wp-content/uploads/2017/03/03.jpg&#34;&gt;Zack Snyder&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Para estudar melhor a paleta de cores utilizadas nos filmes, vamos aplicar a análise introduzida pelo Dani &lt;a href=&#34;http://curso-r.com/blog/2017/04/22/2017-04-21-paleta-de-cores/&#34;&gt;neste post&lt;/a&gt;, com pequenas alterações. Como amostra, selecionei 10 imagens de Batman vs Superman e 10 do Capitão América: guerra civil. Tentando deixar a análise o menos subjetiva possível, escolhi imagens de cenas emblemáticas e dos principais personagens. Abaixo as imagens que peguei de cada filme.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://curso-r.com/blog/2017-05-01-as-paletas-de-cores-da-marvel-vs-dc_files/figure-html/unnamed-chunk-1-1.png&#34; width=&#34;768&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://curso-r.com/blog/2017-05-01-as-paletas-de-cores-da-marvel-vs-dc_files/figure-html/unnamed-chunk-2-1.png&#34; width=&#34;768&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Seguindo a análise do Dani, vamos utilizar as seguintes bibliotecas para a análise.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(jpeg)
library(tidyverse)
library(glue)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Eu salvei as imagens em arquivos do tipo “bvs_n.jpg” e “cw_n.jpg”, com n variando de 1 a 10. Isso facilitou a leitura desses arquivos. O código abaixo mostra como criar um vetor com o caminho das 10 imagens de cada filme. Se você quiser saber mais sobre a função &lt;code&gt;glue()&lt;/code&gt;, visite &lt;a href=&#34;http://curso-r.com/blog/2017/04/17/2017-04-08-glue/&#34;&gt;este post&lt;/a&gt;.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;arquivos_bvs &amp;lt;- glue(&amp;quot;images/bvs_{n}.jpg&amp;quot;, n = 1:10)
arquivos_cw &amp;lt;- glue(&amp;quot;images/cw_{n}.jpg&amp;quot;, n = 1:10)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Como vamos trabalhar com mais de uma imagem, eu criei a função &lt;code&gt;ler_imagem()&lt;/code&gt; para ler os arquivos.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ler_imagem &amp;lt;- function(caminho) {
  img &amp;lt;- readJPEG(caminho) %&amp;gt;% 
    apply(3, as.numeric)
  
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Podemos então usar a função &lt;code&gt;map()&lt;/code&gt; para aplicá-la a todos os 10 arquivos. A função &lt;code&gt;reduce(rbind)&lt;/code&gt; transforma as 10 matrizes de pixels em uma matriz só, como se as imagens estivessem coladas uma embaixo da outra.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;img_bvs &amp;lt;- map(arquivos_bvs, ler_imagem) %&amp;gt;% reduce(rbind)
img_cw &amp;lt;- map(arquivos_cw, ler_imagem) %&amp;gt;% reduce(rbind)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Abaixo estão as funções &lt;code&gt;cria_paleta()&lt;/code&gt; e &lt;code&gt;exibir()&lt;/code&gt; do post do Dani. A única diferença aqui é que a função &lt;code&gt;cria_paleta()&lt;/code&gt; já recebe a matriz representando a imagem.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;criar_paleta &amp;lt;- function(img_matrix, num_cores){
  
  km &amp;lt;- kmeans(img_matrix, centers = num_cores)
  
  img_df &amp;lt;- tibble(
    r = img_matrix[,1], 
    g = img_matrix[,2], 
    b = img_matrix[,3],
    cluster = km$cluster
  )
  
  centroides &amp;lt;- img_df %&amp;gt;%
    group_by(cluster) %&amp;gt;%
    summarise_all(mean)

  centroides &amp;lt;- centroides %&amp;gt;%
    mutate(cor = rgb(r, g, b))

  sort(centroides$cor)
}

exibir &amp;lt;- function(x) {
  n &amp;lt;- length(x)
  old &amp;lt;- par(mar = c(0.5, 0.5, 0.5, 0.5))
  on.exit(par(old))
  
  image(1:n, 1, as.matrix(1:n), col = x,
        ylab = &amp;quot;&amp;quot;, xaxt = &amp;quot;n&amp;quot;, yaxt = &amp;quot;n&amp;quot;, bty = &amp;quot;n&amp;quot;)
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Assim, basta aplicar essas funções aos objetos &lt;code&gt;img_bvs&lt;/code&gt; e &lt;code&gt;img_cw&lt;/code&gt; para obter as paletas. Primeiro para o Batman vs Superman:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;paleta_bvs &amp;lt;- criar_paleta(img_bvs, 10)
exibir(paleta_bvs)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;http://curso-r.com/blog/2017-05-01-as-paletas-de-cores-da-marvel-vs-dc_files/figure-html/unnamed-chunk-9-1.png&#34; width=&#34;768&#34; /&gt;&lt;/p&gt;
&lt;p&gt;E agora para o Capitão América:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;paleta_cw &amp;lt;- criar_paleta(img_cw, 10)
exibir(paleta_cw)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;http://curso-r.com/blog/2017-05-01-as-paletas-de-cores-da-marvel-vs-dc_files/figure-html/unnamed-chunk-11-1.png&#34; width=&#34;768&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Observe que o filme da DC tem cores mais escuras e fortes, com vários tons de azul, indicando as cenas noturnas e de chuva. Já a paleta da Marvel apresenta cores mais claras, com vários tons representando o céu pálido das cenas externas.&lt;/p&gt;
&lt;p&gt;Podemos fazer a análise agora para o pôster de cada filme (o que aparece no IMDB):&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://curso-r.com/blog/2017-05-01-as-paletas-de-cores-da-marvel-vs-dc_files/figure-html/unnamed-chunk-12-1.png&#34; width=&#34;768&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;img_bvs &amp;lt;- ler_imagem(&amp;quot;images/bvs_poster.jpg&amp;quot;)
paleta_bvs &amp;lt;- criar_paleta(img_bvs, 10)
exibir(paleta_bvs)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;http://curso-r.com/blog/2017-05-01-as-paletas-de-cores-da-marvel-vs-dc_files/figure-html/unnamed-chunk-14-1.png&#34; width=&#34;768&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;img_cw &amp;lt;- ler_imagem(&amp;quot;images/cw_poster.jpg&amp;quot;)
paleta_cw &amp;lt;- criar_paleta(img_cw, 10)
exibir(paleta_cw)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;http://curso-r.com/blog/2017-05-01-as-paletas-de-cores-da-marvel-vs-dc_files/figure-html/unnamed-chunk-16-1.png&#34; width=&#34;768&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Veja que os diferentes tons de azul se repete no pôster do Batman vs Superman. Já o pôster do Capitão América é bem cinzento, com metade da paleta representando &lt;a href=&#34;http://media.melty.com.br/article-6991-ratio265_1020/filme-50-tons-de-cinza-jamie-dornan-christian.jpg&#34;&gt;tons de cinza&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Fica então o desafio de repetir a análise para outros filmes e compartilhar o resultado com a gente. Comentários? Sugestões? Críticas? Mande a sua opinião!&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>